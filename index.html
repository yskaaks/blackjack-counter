<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Counter</title>
    <meta name="description" content="Hi-Lo card counting assistant for online blackjack">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a26;
            --bg-elevated: #22222f;
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-glow: rgba(255, 255, 255, 0.12);

            --text-primary: #f0f0f5;
            --text-secondary: #8888a0;
            --text-muted: #55556a;

            --green-bg: #0d3320;
            --green-border: #1a6b3f;
            --green-text: #34d97b;
            --green-glow: rgba(52, 217, 123, 0.15);

            --red-bg: #331015;
            --red-border: #6b1a22;
            --red-text: #ff4d5e;
            --red-glow: rgba(255, 77, 94, 0.15);

            --neutral-bg: #1e1e2a;
            --neutral-border: #3a3a4f;
            --neutral-text: #a0a0b8;

            --accent: #7c6aff;
            --accent-glow: rgba(124, 106, 255, 0.2);

            --gold: #f0c040;
            --gold-glow: rgba(240, 192, 64, 0.15);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* â”€â”€ Layout â”€â”€ */
        .app {
            max-width: 480px;
            margin: 0 auto;
            padding: 16px 16px 24px;
            display: flex;
            flex-direction: column;
            gap: 14px;
            min-height: 100vh;
        }

        /* â”€â”€ Header â”€â”€ */
        .header {
            text-align: center;
            padding: 8px 0 4px;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--accent), var(--green-text));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* â”€â”€ Count Display â”€â”€ */
        .counts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .count-box {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 14px 12px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .count-box::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .count-box.positive::before {
            background: radial-gradient(ellipse at center, var(--green-glow), transparent 70%);
            opacity: 1;
        }

        .count-box.negative::before {
            background: radial-gradient(ellipse at center, var(--red-glow), transparent 70%);
            opacity: 1;
        }

        .count-box.positive {
            border-color: var(--green-border);
        }

        .count-box.negative {
            border-color: var(--red-border);
        }

        .count-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            position: relative;
        }

        .count-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 36px;
            font-weight: 700;
            position: relative;
            transition: color 0.3s ease;
        }

        .count-box.positive .count-value {
            color: var(--green-text);
        }

        .count-box.negative .count-value {
            color: var(--red-text);
        }

        /* â”€â”€ Betting Advice â”€â”€ */
        .advice {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 10px 14px;
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            letter-spacing: 0.3px;
        }

        .advice.hot {
            background: var(--green-bg);
            border-color: var(--green-border);
            color: var(--green-text);
        }

        .advice.cold {
            background: var(--red-bg);
            border-color: var(--red-border);
            color: var(--red-text);
        }

        .advice.warm {
            background: var(--bg-elevated);
            border-color: var(--neutral-border);
            color: var(--gold);
        }

        .advice.neutral {
            color: var(--text-secondary);
        }

        /* â”€â”€ Card Grid â”€â”€ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .card-btn {
            position: relative;
            aspect-ratio: 1;
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.12s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
        }

        .card-btn .hi-lo-val {
            font-size: 10px;
            font-weight: 600;
            opacity: 0.7;
        }

        /* Plus cards (2-6) */
        .card-btn.plus {
            background: var(--green-bg);
            border-color: var(--green-border);
            color: var(--green-text);
        }

        .card-btn.plus:hover {
            background: #104028;
            border-color: #28a060;
            box-shadow: 0 0 20px var(--green-glow);
        }

        .card-btn.plus:active {
            transform: scale(0.92);
            background: #18553a;
        }

        /* Neutral cards (7-9) */
        .card-btn.zero {
            background: var(--neutral-bg);
            border-color: var(--neutral-border);
            color: var(--neutral-text);
        }

        .card-btn.zero:hover {
            background: #282838;
            border-color: #505068;
        }

        .card-btn.zero:active {
            transform: scale(0.92);
            background: #303044;
        }

        /* Minus cards (10, J, Q, K, A) */
        .card-btn.minus {
            background: var(--red-bg);
            border-color: var(--red-border);
            color: var(--red-text);
        }

        .card-btn.minus:hover {
            background: #401520;
            border-color: #a02838;
            box-shadow: 0 0 20px var(--red-glow);
        }

        .card-btn.minus:active {
            transform: scale(0.92);
            background: #4a1a28;
        }

        /* Flash effect on click */
        .card-btn .flash {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 10px;
            opacity: 0;
            pointer-events: none;
        }

        .card-btn.clicked .flash {
            animation: flashPulse 0.25s ease-out;
        }

        @keyframes flashPulse {
            0% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* â”€â”€ Controls Row â”€â”€ */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .ctrl-btn {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-card);
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .ctrl-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border-color: var(--border-glow);
        }

        .ctrl-btn:active {
            transform: scale(0.96);
        }

        .ctrl-btn.undo {
            border-color: rgba(124, 106, 255, 0.3);
            color: var(--accent);
        }

        .ctrl-btn.undo:hover {
            background: rgba(124, 106, 255, 0.1);
        }

        .ctrl-btn.reset {
            border-color: rgba(255, 77, 94, 0.3);
            color: var(--red-text);
        }

        .ctrl-btn.reset:hover {
            background: rgba(255, 77, 94, 0.1);
        }

        /* â”€â”€ Shoe Config â”€â”€ */
        .shoe-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 10px 16px;
            gap: 10px;
        }

        .shoe-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shoe-left label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .shoe-toggle {
            display: flex;
            gap: 4px;
        }

        .shoe-opt {
            padding: 5px 12px;
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-elevated);
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .shoe-opt:hover {
            border-color: var(--border-glow);
            color: var(--text-primary);
        }

        .shoe-opt.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
        }

        .shoe-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .shoe-right .decks-auto {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .shoe-right .decks-auto-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
        }

        /* â”€â”€ Penetration Bar â”€â”€ */
        .penetration-bar {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 8px 14px;
        }

        .penetration-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .penetration-header span {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
        }

        .penetration-header .pen-pct {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .pen-track {
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .pen-fill {
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--accent), var(--green-text));
            transition: width 0.3s ease;
            min-width: 0;
        }

        .pen-fill.deep {
            background: linear-gradient(90deg, var(--gold), var(--red-text));
        }

        /* â”€â”€ History / Cards Seen â”€â”€ */
        .history-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 10px 14px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .history-header span {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
        }

        .cards-seen {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .history-strip {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            min-height: 24px;
        }

        .history-chip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 3px 7px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            animation: chipIn 0.15s ease-out;
        }

        .history-chip.plus {
            background: var(--green-bg);
            color: var(--green-text);
            border: 1px solid var(--green-border);
        }

        .history-chip.zero {
            background: var(--neutral-bg);
            color: var(--neutral-text);
            border: 1px solid var(--neutral-border);
        }

        .history-chip.minus {
            background: var(--red-bg);
            color: var(--red-text);
            border: 1px solid var(--red-border);
        }

        @keyframes chipIn {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* â”€â”€ Stats Row â”€â”€ */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .stat-box {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 8px;
            text-align: center;
        }

        .stat-box .stat-label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .stat-box .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-secondary);
        }

        /* â”€â”€ Keyboard Shortcuts Hint â”€â”€ */
        .shortcuts-hint {
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            padding: 4px 0;
            letter-spacing: 0.3px;
        }

        .shortcuts-hint kbd {
            display: inline-block;
            padding: 1px 5px;
            border-radius: 4px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            margin: 0 1px;
        }

        /* Count change animation */
        .count-value.bump-up {
            animation: bumpUp 0.2s ease-out;
        }

        .count-value.bump-down {
            animation: bumpDown 0.2s ease-out;
        }

        @keyframes bumpUp {
            0% {
                transform: translateY(4px);
                opacity: 0.5;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes bumpDown {
            0% {
                transform: translateY(-4px);
                opacity: 0.5;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* â”€â”€ Strategy Advisor â”€â”€ */
        .strategy-panel {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 12px 14px;
        }

        .strategy-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .strategy-panel-header span {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-secondary);
        }

        .strategy-inputs {
            display: flex;
            gap: 8px;
            align-items: stretch;
        }

        .strategy-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .strategy-col label {
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
        }

        .hand-select,
        .dealer-select {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 600;
            padding: 8px 10px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
            transition: border-color 0.15s ease;
        }

        .hand-select:focus,
        .dealer-select:focus {
            border-color: var(--accent);
        }

        .strategy-result {
            margin-top: 8px;
            padding: 10px 12px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.3px;
            transition: all 0.2s ease;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .strategy-result.hit {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .strategy-result.stand {
            background: var(--green-bg);
            border: 1px solid var(--green-border);
            color: var(--green-text);
        }

        .strategy-result.double {
            background: var(--gold-glow);
            border: 1px solid rgba(240, 192, 64, 0.4);
            color: var(--gold);
        }

        .strategy-result.split {
            background: var(--accent-glow);
            border: 1px solid rgba(124, 106, 255, 0.4);
            color: #a78bfa;
        }

        .strategy-result.surrender {
            background: var(--red-bg);
            border: 1px solid var(--red-border);
            color: var(--red-text);
        }

        .strategy-result.waiting {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-weight: 500;
            font-size: 12px;
        }

        .strategy-result .deviation-tag {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <h1>â™  Blackjack Counter</h1>
        </div>

        <!-- Count Display -->
        <div class="counts">
            <div class="count-box" id="rc-box">
                <div class="count-label">Running Count</div>
                <div class="count-value" id="running-count">0</div>
            </div>
            <div class="count-box" id="tc-box">
                <div class="count-label">True Count</div>
                <div class="count-value" id="true-count">0.0</div>
            </div>
        </div>

        <!-- Betting Advice -->
        <div class="advice neutral" id="advice">Waiting for cardsâ€¦</div>

        <!-- Strategy Advisor -->
        <div class="strategy-panel">
            <div class="strategy-panel-header">
                <span>ðŸŽ¯ Strategy Advisor</span>
            </div>
            <div class="strategy-inputs">
                <div class="strategy-col">
                    <label>Your Hand</label>
                    <select class="hand-select" id="player-hand" onchange="updateStrategy()">
                        <option value="">Selectâ€¦</option>
                        <optgroup label="Hard Totals">
                            <option value="H8">Hard 8</option>
                            <option value="H9">Hard 9</option>
                            <option value="H10">Hard 10</option>
                            <option value="H11">Hard 11</option>
                            <option value="H12">Hard 12</option>
                            <option value="H13">Hard 13</option>
                            <option value="H14">Hard 14</option>
                            <option value="H15">Hard 15</option>
                            <option value="H16">Hard 16</option>
                            <option value="H17">Hard 17+</option>
                        </optgroup>
                        <optgroup label="Soft Totals">
                            <option value="S13">Soft 13 (A,2)</option>
                            <option value="S14">Soft 14 (A,3)</option>
                            <option value="S15">Soft 15 (A,4)</option>
                            <option value="S16">Soft 16 (A,5)</option>
                            <option value="S17">Soft 17 (A,6)</option>
                            <option value="S18">Soft 18 (A,7)</option>
                            <option value="S19">Soft 19 (A,8)</option>
                            <option value="S20">Soft 20 (A,9)</option>
                        </optgroup>
                        <optgroup label="Pairs">
                            <option value="P2">2,2</option>
                            <option value="P3">3,3</option>
                            <option value="P4">4,4</option>
                            <option value="P5">5,5</option>
                            <option value="P6">6,6</option>
                            <option value="P7">7,7</option>
                            <option value="P8">8,8</option>
                            <option value="P9">9,9</option>
                            <option value="PT">10,10</option>
                            <option value="PA">A,A</option>
                        </optgroup>
                    </select>
                </div>
                <div class="strategy-col">
                    <label>Dealer Shows</label>
                    <select class="dealer-select" id="dealer-card" onchange="updateStrategy()">
                        <option value="">Selectâ€¦</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10 / J / Q / K</option>
                        <option value="A">A</option>
                    </select>
                </div>
            </div>
            <div class="strategy-result waiting" id="strategy-result">
                Select your hand &amp; dealer upcard
            </div>
        </div>

        <!-- Card Grid -->
        <div class="card-grid" id="card-grid">
            <!-- Row 1: Low cards -->
            <button class="card-btn plus" data-rank="2" id="btn-2">
                <div class="flash"></div>
                <span>2</span>
                <span class="hi-lo-val">+1</span>
            </button>
            <button class="card-btn plus" data-rank="3" id="btn-3">
                <div class="flash"></div>
                <span>3</span>
                <span class="hi-lo-val">+1</span>
            </button>
            <button class="card-btn plus" data-rank="4" id="btn-4">
                <div class="flash"></div>
                <span>4</span>
                <span class="hi-lo-val">+1</span>
            </button>
            <button class="card-btn plus" data-rank="5" id="btn-5">
                <div class="flash"></div>
                <span>5</span>
                <span class="hi-lo-val">+1</span>
            </button>
            <button class="card-btn plus" data-rank="6" id="btn-6">
                <div class="flash"></div>
                <span>6</span>
                <span class="hi-lo-val">+1</span>
            </button>
            <!-- Row 2: Neutral -->
            <button class="card-btn zero" data-rank="7" id="btn-7">
                <div class="flash"></div>
                <span>7</span>
                <span class="hi-lo-val">0</span>
            </button>
            <button class="card-btn zero" data-rank="8" id="btn-8">
                <div class="flash"></div>
                <span>8</span>
                <span class="hi-lo-val">0</span>
            </button>
            <button class="card-btn zero" data-rank="9" id="btn-9">
                <div class="flash"></div>
                <span>9</span>
                <span class="hi-lo-val">0</span>
            </button>
            <!-- Row 2 continued: High cards start -->
            <button class="card-btn minus" data-rank="10" id="btn-10">
                <div class="flash"></div>
                <span>10</span>
                <span class="hi-lo-val">-1</span>
            </button>
            <button class="card-btn minus" data-rank="J" id="btn-J">
                <div class="flash"></div>
                <span>J</span>
                <span class="hi-lo-val">-1</span>
            </button>
            <!-- Row 3 -->
            <button class="card-btn minus" data-rank="Q" id="btn-Q">
                <div class="flash"></div>
                <span>Q</span>
                <span class="hi-lo-val">-1</span>
            </button>
            <button class="card-btn minus" data-rank="K" id="btn-K">
                <div class="flash"></div>
                <span>K</span>
                <span class="hi-lo-val">-1</span>
            </button>
            <button class="card-btn minus" data-rank="A" id="btn-A">
                <div class="flash"></div>
                <span>A</span>
                <span class="hi-lo-val">-1</span>
            </button>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="ctrl-btn undo" id="undo-btn" onclick="undo()">â†© Undo Last</button>
            <button class="ctrl-btn reset" id="reset-btn" onclick="resetAll()">âŸ³ New Shoe</button>
        </div>

        <!-- Shoe Size -->
        <div class="shoe-row">
            <div class="shoe-left">
                <label>Shoe</label>
                <div class="shoe-toggle">
                    <button class="shoe-opt" data-decks="2" id="shoe-2" onclick="setShoe(2)">2</button>
                    <button class="shoe-opt" data-decks="4" id="shoe-4" onclick="setShoe(4)">4</button>
                    <button class="shoe-opt active" data-decks="6" id="shoe-6" onclick="setShoe(6)">6</button>
                    <button class="shoe-opt" data-decks="8" id="shoe-8" onclick="setShoe(8)">8</button>
                </div>
            </div>
            <div class="shoe-right">
                <div style="text-align: right;">
                    <div class="decks-auto-label">Decks Left</div>
                    <div class="decks-auto" id="decks-auto">6.0</div>
                </div>
            </div>
        </div>

        <!-- Penetration Bar -->
        <div class="penetration-bar">
            <div class="penetration-header">
                <span>Shoe Penetration</span>
                <span class="pen-pct" id="pen-pct">0%</span>
            </div>
            <div class="pen-track">
                <div class="pen-fill" id="pen-fill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-label">Cards Seen</div>
                <div class="stat-value" id="cards-seen">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Cards Left</div>
                <div class="stat-value" id="cards-left">312</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Decks Left</div>
                <div class="stat-value" id="decks-left">6.0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Hands</div>
                <div class="stat-value" id="hands-count">0</div>
            </div>
        </div>

        <!-- History -->
        <div class="history-section">
            <div class="history-header">
                <span>Recent Cards</span>
                <span class="cards-seen" id="history-count"></span>
            </div>
            <div class="history-strip" id="history-strip">
                <!-- chips appear here -->
            </div>
        </div>

        <!-- Keyboard Shortcuts -->
        <div class="shortcuts-hint">
            Keys: <kbd>2</kbd>â€“<kbd>9</kbd> <kbd>0</kbd>=10 <kbd>J</kbd> <kbd>Q</kbd> <kbd>K</kbd> <kbd>A</kbd> Â·
            <kbd>Z</kbd>=Undo Â· <kbd>R</kbd>=Reset Â· <kbd>N</kbd>=New Hand
        </div>
    </div>

    <script>
        // â”€â”€ State â”€â”€
        let runningCount = 0;
        let totalDecks = 6;
        let history = []; // stack of { rank, value }
        let handsCount = 0;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BASIC STRATEGY TABLES (H17, DAS allowed)
        // Key format: "HandType_DealerUpcard"
        // Values: H=Hit, S=Stand, D=Double(hit), Ds=Double(stand), Sp=Split, Rh=Surrender(hit), Rs=Surrender(stand)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Hard totals: [2,3,4,5,6,7,8,9,10,A]
        const HARD = {
            8: ['H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H'],
            9: ['H', 'D', 'D', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            10: ['D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'H', 'H'],
            11: ['D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'D'],
            12: ['H', 'H', 'S', 'S', 'S', 'H', 'H', 'H', 'H', 'H'],
            13: ['S', 'S', 'S', 'S', 'S', 'H', 'H', 'H', 'H', 'H'],
            14: ['S', 'S', 'S', 'S', 'S', 'H', 'H', 'H', 'H', 'H'],
            15: ['S', 'S', 'S', 'S', 'S', 'H', 'H', 'H', 'Rh', 'Rh'],
            16: ['S', 'S', 'S', 'S', 'S', 'H', 'H', 'Rh', 'Rh', 'Rh'],
            17: ['S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'Rs'],
        };

        // Soft totals: [2,3,4,5,6,7,8,9,10,A]
        const SOFT = {
            13: ['H', 'H', 'H', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            14: ['H', 'H', 'H', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            15: ['H', 'H', 'D', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            16: ['H', 'H', 'D', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            17: ['H', 'D', 'D', 'D', 'D', 'H', 'H', 'H', 'H', 'H'],
            18: ['Ds', 'Ds', 'Ds', 'Ds', 'Ds', 'S', 'S', 'H', 'H', 'H'],
            19: ['S', 'S', 'S', 'S', 'Ds', 'S', 'S', 'S', 'S', 'S'],
            20: ['S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'S'],
        };

        // Pairs: [2,3,4,5,6,7,8,9,10,A]
        const PAIRS = {
            2: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'H', 'H', 'H', 'H'],
            3: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'H', 'H', 'H', 'H'],
            4: ['H', 'H', 'H', 'Sp', 'Sp', 'H', 'H', 'H', 'H', 'H'],
            5: ['D', 'D', 'D', 'D', 'D', 'D', 'D', 'D', 'H', 'H'],
            6: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'H', 'H', 'H', 'H', 'H'],
            7: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'H', 'H', 'H', 'H'],
            8: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp'],
            9: ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'S', 'Sp', 'Sp', 'S', 'S'],
            10: ['S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'S', 'S'],
            'A': ['Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp', 'Sp'],
        };

        // Dealer upcard to column index
        function dealerIndex(upcard) {
            const map = { '2': 0, '3': 1, '4': 2, '5': 3, '6': 4, '7': 5, '8': 6, '9': 7, '10': 8, 'A': 9 };
            return map[upcard];
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ILLUSTRIOUS 18 + FAB 4 SURRENDER DEVIATIONS
        // Each: { hand, dealer, tcThreshold, action, defaultAction, description }
        // "action" is what to do WHEN TC >= threshold (or <= for negative thresholds)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const DEVIATIONS = [
            // ILLUSTRIOUS 18 (ordered by importance)
            { hand: 'PT', dealer: '5', tc: 5, compare: '>=', action: 'Sp', desc: 'Split 10s vs 5' },
            { hand: 'PT', dealer: '6', tc: 4, compare: '>=', action: 'Sp', desc: 'Split 10s vs 6' },
            { hand: 'H10', dealer: '10', tc: 4, compare: '>=', action: 'D', desc: 'Double 10 vs 10' },
            { hand: 'H10', dealer: 'A', tc: 4, compare: '>=', action: 'D', desc: 'Double 10 vs A' },
            { hand: 'INS', dealer: 'A', tc: 3, compare: '>=', action: 'INS', desc: 'Take Insurance' },
            { hand: 'H9', dealer: '2', tc: 1, compare: '>=', action: 'D', desc: 'Double 9 vs 2' },
            { hand: 'H9', dealer: '7', tc: 3, compare: '>=', action: 'D', desc: 'Double 9 vs 7' },
            { hand: 'H16', dealer: '9', tc: 5, compare: '>=', action: 'S', desc: 'Stand 16 vs 9' },
            { hand: 'H16', dealer: '10', tc: 0, compare: '>=', action: 'S', desc: 'Stand 16 vs 10' },
            { hand: 'H15', dealer: '10', tc: 4, compare: '>=', action: 'S', desc: 'Stand 15 vs 10' },
            { hand: 'PT', dealer: '4', tc: 6, compare: '>=', action: 'Sp', desc: 'Split 10s vs 4' },
            { hand: 'H12', dealer: '3', tc: 2, compare: '>=', action: 'S', desc: 'Stand 12 vs 3' },
            { hand: 'H12', dealer: '2', tc: 3, compare: '>=', action: 'S', desc: 'Stand 12 vs 2' },
            { hand: 'H11', dealer: 'A', tc: 1, compare: '>=', action: 'D', desc: 'Double 11 vs A' },
            { hand: 'H13', dealer: '2', tc: -1, compare: '<=', action: 'H', desc: 'Hit 13 vs 2' },
            { hand: 'H13', dealer: '3', tc: -2, compare: '<=', action: 'H', desc: 'Hit 13 vs 3' },
            { hand: 'H12', dealer: '4', tc: 0, compare: '<', action: 'H', desc: 'Hit 12 vs 4' },
            { hand: 'H12', dealer: '5', tc: -2, compare: '<=', action: 'H', desc: 'Hit 12 vs 5' },
            { hand: 'H12', dealer: '6', tc: -1, compare: '<=', action: 'H', desc: 'Hit 12 vs 6' },
            // FAB 4 SURRENDER DEVIATIONS
            { hand: 'H14', dealer: '10', tc: 3, compare: '>=', action: 'Rh', desc: 'Surrender 14 vs 10' },
            { hand: 'H15', dealer: '10', tc: 0, compare: '>=', action: 'Rh', desc: 'Surrender 15 vs 10' },
            { hand: 'H15', dealer: 'A', tc: 1, compare: '>=', action: 'Rh', desc: 'Surrender 15 vs A' },
            { hand: 'H14', dealer: 'A', tc: 7, compare: '>=', action: 'Rh', desc: 'Surrender 14 vs A' },
        ];

        function getBasicStrategy(handCode, dealerUp) {
            const di = dealerIndex(dealerUp);
            if (di === undefined) return null;

            const type = handCode[0]; // H, S, or P
            const val = handCode.substring(1); // number or 'T' or 'A'

            if (type === 'H') {
                const num = parseInt(val);
                if (num <= 8) return 'H';
                if (num >= 17) return HARD[17][di];
                return HARD[num] ? HARD[num][di] : 'H';
            } else if (type === 'S') {
                const num = parseInt(val);
                if (num >= 20) return 'S';
                if (num <= 13) return SOFT[13] ? SOFT[13][di] : 'H';
                return SOFT[num] ? SOFT[num][di] : 'H';
            } else if (type === 'P') {
                const pairVal = val === 'T' ? 10 : val === 'A' ? 'A' : parseInt(val);
                return PAIRS[pairVal] ? PAIRS[pairVal][di] : 'H';
            }
            return 'H';
        }

        function checkDeviations(handCode, dealerUp, tc) {
            for (const dev of DEVIATIONS) {
                if (dev.hand === handCode && dev.dealer === dealerUp) {
                    let triggered = false;
                    if (dev.compare === '>=' && tc >= dev.tc) triggered = true;
                    if (dev.compare === '<=' && tc <= dev.tc) triggered = true;
                    if (dev.compare === '<' && tc < dev.tc) triggered = true;
                    if (dev.compare === '>' && tc > dev.tc) triggered = true;

                    if (triggered) {
                        return { action: dev.action, desc: dev.desc, tc: dev.tc };
                    }
                }
            }
            return null;
        }

        function actionLabel(code) {
            const labels = {
                'H': 'HIT', 'S': 'STAND', 'D': 'DOUBLE', 'Ds': 'DOUBLE (stand if not allowed)',
                'Sp': 'SPLIT', 'Rh': 'SURRENDER (hit if not allowed)',
                'Rs': 'SURRENDER (stand if not allowed)', 'INS': 'TAKE INSURANCE'
            };
            return labels[code] || code;
        }

        function actionClass(code) {
            if (code === 'H') return 'hit';
            if (code === 'S' || code === 'Rs') return 'stand';
            if (code === 'D' || code === 'Ds') return 'double';
            if (code === 'Sp') return 'split';
            if (code === 'Rh') return 'surrender';
            return 'waiting';
        }

        function updateStrategy() {
            const handCode = document.getElementById('player-hand').value;
            const dealerUp = document.getElementById('dealer-card').value;
            const resultEl = document.getElementById('strategy-result');

            if (!handCode || !dealerUp) {
                resultEl.className = 'strategy-result waiting';
                resultEl.innerHTML = 'Select your hand &amp; dealer upcard';
                return;
            }

            const tc = runningCount / getDecksRemaining();
            const basic = getBasicStrategy(handCode, dealerUp);
            const deviation = checkDeviations(handCode, dealerUp, tc);

            if (deviation) {
                const cls = actionClass(deviation.action);
                resultEl.className = `strategy-result ${cls}`;
                resultEl.innerHTML = `${actionLabel(deviation.action)} <span class="deviation-tag">Deviation @ TC ${deviation.tc >= 0 ? '+' : ''}${deviation.tc}</span>`;
            } else {
                const cls = actionClass(basic);
                resultEl.className = `strategy-result ${cls}`;
                resultEl.innerHTML = actionLabel(basic);
            }
        }


        const HI_LO = {
            '2': 1, '3': 1, '4': 1, '5': 1, '6': 1,
            '7': 0, '8': 0, '9': 0,
            '10': -1, 'J': -1, 'Q': -1, 'K': -1, 'A': -1
        };

        function getHiLoClass(rank) {
            const v = HI_LO[rank];
            if (v > 0) return 'plus';
            if (v < 0) return 'minus';
            return 'zero';
        }

        // â”€â”€ Core Logic â”€â”€
        function addCard(rank) {
            const value = HI_LO[rank];
            if (value === undefined) return;

            runningCount += value;
            history.push({ rank, value });

            updateUI();
            animateCount(value);
        }

        function undo() {
            if (history.length === 0) return;
            const last = history.pop();
            runningCount -= last.value;
            updateUI();
        }

        function resetAll() {
            runningCount = 0;
            history = [];
            handsCount = 0;
            updateUI();
        }

        function newHand() {
            handsCount++;
            updateUI();
        }

        function setShoe(decks) {
            totalDecks = decks;
            // Update active button
            document.querySelectorAll('.shoe-opt').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.decks) === decks);
            });
            updateUI();
        }

        function getDecksRemaining() {
            const cardsSeen = history.length;
            const totalCards = totalDecks * 52;
            return Math.max(0.5, (totalCards - cardsSeen) / 52);
        }

        // â”€â”€ UI Updates â”€â”€
        function updateUI() {
            const cardsSeen = history.length;
            const totalCards = totalDecks * 52;
            const cardsLeft = totalCards - cardsSeen;
            const decksLeft = getDecksRemaining();
            const trueCount = runningCount / decksLeft;
            const penetration = cardsSeen / totalCards;
            const penPct = Math.min(100, Math.round(penetration * 100));

            // Counts
            const rcEl = document.getElementById('running-count');
            const tcEl = document.getElementById('true-count');
            rcEl.textContent = runningCount > 0 ? `+${runningCount}` : runningCount;
            tcEl.textContent = trueCount > 0 ? `+${trueCount.toFixed(1)}` : trueCount.toFixed(1);

            // Count box styling
            const rcBox = document.getElementById('rc-box');
            const tcBox = document.getElementById('tc-box');
            rcBox.className = 'count-box' + (runningCount > 0 ? ' positive' : runningCount < 0 ? ' negative' : '');
            tcBox.className = 'count-box' + (trueCount > 0 ? ' positive' : trueCount < 0 ? ' negative' : '');

            // Advice
            const adviceEl = document.getElementById('advice');
            if (cardsSeen === 0) {
                adviceEl.textContent = 'Waiting for cardsâ€¦';
                adviceEl.className = 'advice neutral';
            } else if (trueCount >= 3) {
                adviceEl.textContent = 'ðŸ”¥ HIGH ADVANTAGE â€” Increase bet significantly';
                adviceEl.className = 'advice hot';
            } else if (trueCount >= 2) {
                adviceEl.textContent = 'ðŸ“ˆ Good count â€” Increase bet';
                adviceEl.className = 'advice hot';
            } else if (trueCount >= 1) {
                adviceEl.textContent = 'â¬† Slight advantage â€” Consider raising bet';
                adviceEl.className = 'advice warm';
            } else if (trueCount <= -2) {
                adviceEl.textContent = 'â¬‡ House advantage â€” Minimum bet or sit out';
                adviceEl.className = 'advice cold';
            } else if (trueCount <= -1) {
                adviceEl.textContent = 'ðŸ“‰ Negative count â€” Minimum bet';
                adviceEl.className = 'advice cold';
            } else {
                adviceEl.textContent = 'âž– Neutral â€” Play basic strategy';
                adviceEl.className = 'advice neutral';
            }

            // Stats
            document.getElementById('cards-seen').textContent = cardsSeen;
            document.getElementById('cards-left').textContent = cardsLeft;
            document.getElementById('decks-left').textContent = decksLeft.toFixed(1);
            document.getElementById('hands-count').textContent = handsCount;

            // Auto decks remaining display
            document.getElementById('decks-auto').textContent = decksLeft.toFixed(1);

            // Penetration bar
            const penFill = document.getElementById('pen-fill');
            penFill.style.width = `${penPct}%`;
            penFill.className = 'pen-fill' + (penPct >= 65 ? ' deep' : '');
            document.getElementById('pen-pct').textContent = `${penPct}%`;

            // History strip - show last 30 cards
            const strip = document.getElementById('history-strip');
            const recent = history.slice(-30);
            strip.innerHTML = recent.map(h =>
                `<span class="history-chip ${getHiLoClass(h.rank)}">${h.rank}</span>`
            ).join('');
            // scroll to end
            strip.scrollLeft = strip.scrollWidth;

            // Also update strategy advisor if selections are made
            updateStrategy();
        }

        function animateCount(value) {
            const rc = document.getElementById('running-count');
            const tc = document.getElementById('true-count');
            const cls = value > 0 ? 'bump-up' : value < 0 ? 'bump-down' : '';
            if (!cls) return;

            rc.classList.remove('bump-up', 'bump-down');
            tc.classList.remove('bump-up', 'bump-down');
            // Force reflow
            void rc.offsetWidth;
            rc.classList.add(cls);
            tc.classList.add(cls);
        }

        // â”€â”€ Button Click Handlers â”€â”€
        document.querySelectorAll('.card-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const rank = btn.dataset.rank;
                addCard(rank);

                // Flash animation
                btn.classList.remove('clicked');
                void btn.offsetWidth;
                btn.classList.add('clicked');
                setTimeout(() => btn.classList.remove('clicked'), 250);
            });
        });

        // â”€â”€ Keyboard Shortcuts â”€â”€
        document.addEventListener('keydown', (e) => {
            // Don't trigger if user is typing in an input
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            const key = e.key.toUpperCase();

            const keyMap = {
                '2': '2', '3': '3', '4': '4', '5': '5', '6': '6',
                '7': '7', '8': '8', '9': '9',
                '0': '10',  // 0 key for 10
                'J': 'J', 'Q': 'Q', 'K': 'K', 'A': 'A',
            };

            if (keyMap[key]) {
                e.preventDefault();
                addCard(keyMap[key]);

                // Visual feedback on corresponding button
                const btn = document.querySelector(`[data-rank="${keyMap[key]}"]`);
                if (btn) {
                    btn.classList.remove('clicked');
                    void btn.offsetWidth;
                    btn.classList.add('clicked');
                    setTimeout(() => btn.classList.remove('clicked'), 250);
                }
            } else if (key === 'Z') {
                e.preventDefault();
                undo();
            } else if (key === 'R') {
                e.preventDefault();
                resetAll();
            } else if (key === 'N') {
                e.preventDefault();
                newHand();
            }
        });

        // â”€â”€ Init â”€â”€
        updateUI();
    </script>
</body>

</html>